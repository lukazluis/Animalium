<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Animalium - Cl√≠nica Veterinaria üêæ</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Inter',sans-serif; background:#f8f8f8; color:#333; }
    .text-animalium-green { color:#5F7C7D; }
    .bg-animalium-green { background:#5F7C7D; }
    .bg-animalium-brown { background:#CDB79F; }
    .btn-primary { @apply px-6 py-3 rounded-full font-semibold text-white bg-animalium-green hover:bg-opacity-90 shadow-md; }
    .section-title { @apply text-3xl md:text-4xl font-bold text-animalium-green mb-8 text-center; }
    /* error overlay */
    #error-overlay {
      position:fixed; top:0; left:0; width:100%; max-height:30%; overflow-y:auto;
      background:rgba(255,0,0,0.9); color:#fff; font-family:monospace; padding:0.5rem; z-index:9999; display:none;
    }
  </style>
</head>
<body class="antialiased">
  <div id="error-overlay"></div>
  <div id="app-root">
    <div class="min-h-screen flex items-center justify-center bg-gray-100">
      <p class="text-xl text-animalium-green">Cargando aplicaci√≥n...</p>
    </div>
  </div>

  <div id="custom-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
      <p id="modal-message" class="text-gray-800 mb-4"></p>
      <div id="modal-buttons" class="flex justify-center gap-4"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, deleteDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAPLGpjyB5uiWolX28d31td4magMvYeZ4A",
      authDomain: "animalium-22e17.firebaseapp.com",
      projectId: "animalium-22e17",
      storageBucket: "animalium-22e17.appspot.com",
      messagingSenderId: "800956760641",
      appId: "1:800956760641:web:dab9057b718e240ec8bcc0",
      measurementId: "G-NBC5NT1GJD"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Global state
    window.currentUser = null;
    window.currentUserId = null;
    window.isAuthReady = false;
    let currentPage = 'home';
    let unsubscribeAppointments = null;

    // Error overlay
    window.onerror = (msg, src, ln, col) => {
      const o = document.getElementById('error-overlay');
      o.style.display='block';
      o.innerHTML += `<div><strong>${msg}</strong><br>${src}:${ln}:${col}</div><hr>`;
      return true;
    };
    window.addEventListener('unhandledrejection', evt => {
      const o = document.getElementById('error-overlay');
      o.style.display='block';
      o.innerHTML += `<div><strong>Promise Rejection:</strong> ${evt.reason}</div><hr>`;
    });

    // Modal
    function showModal(msg, type='alert', onConfirm=null) {
      const modal = document.getElementById('custom-modal');
      const msgEl = document.getElementById('modal-message');
      const btns = document.getElementById('modal-buttons');
      msgEl.textContent = msg;
      btns.innerHTML = '';
      if(type==='alert') {
        const ok = document.createElement('button');
        ok.textContent = 'OK';
        ok.className='px-4 py-2 bg-animalium-green text-white rounded';
        ok.onclick = () => { modal.classList.add('hidden'); onConfirm?.(); };
        btns.append(ok);
      } else {
        const yes = document.createElement('button');
        yes.textContent='Confirmar';
        yes.className='px-4 py-2 bg-red-500 text-white rounded';
        yes.onclick=()=>{ modal.classList.add('hidden'); onConfirm(true);}
        const no = document.createElement('button');
        no.textContent='Cancelar';
        no.className='px-4 py-2 bg-gray-300 text-black rounded';
        no.onclick=()=>{ modal.classList.add('hidden'); onConfirm(false);}
        btns.append(yes,no);
      }
      modal.classList.remove('hidden');
    }

    // Navigation
    function navigateTo(page) { currentPage = page; renderPage(); }
    window.navigateTo = navigateTo;
    window.handleLogout = () => {
      showModal('¬øCerrar sesi√≥n?','confirm', async ok=>{
        if(ok){ await signOut(auth); navigateTo('home'); showModal('Sesi√≥n cerrada.'); }
      });
    };

    // Listen auth
    onAuthStateChanged(auth, user=>{
      window.currentUser = user;
      window.currentUserId = user?.uid || crypto.randomUUID();
      window.isAuthReady=true;
      renderPage();
    });

    // Render functions (header, pages...) omitted for brevity...
    // For this example, we assume these functions are defined here:
    // renderHeader, renderHeroSection, renderServicesSection, renderAboutUsSection,
    // renderClinicPhotos, renderContactSection, renderFooter,
    // renderAuthPage, attachAuthListeners,
    // renderDashboard, attachDashboardListeners, fetchAppointments,
    // deleteAppointment

    // To implement, copy and paste your existing UI logic here, ensuring renderPage is defined.

    window.onload = ()=>{ if(window.isAuthReady) renderPage(); };
  </script>
</body>
</html>
