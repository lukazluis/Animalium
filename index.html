<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Animalium - Clínica Veterinaria 🐾</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- OpenSearch -->
  <link rel="search" type="application/opensearchdescription+xml"
        title="Animalium" href="/opensearch.xml"/>
  <style>
    .text-animalium-green { color: #5F7C7D; }
    .bg-animalium-green { background-color: #5F7C7D; }
    .bg-animalium-brown { background-color: #CDB79F; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div id="app-root" class="w-full max-w-md bg-white rounded-xl shadow-lg overflow-hidden">
    <p class="text-animalium-green text-center py-6">Cargando aplicación...</p>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAPLGpjyB5uiWolX28d31td4magMvYeZ4A",
      authDomain: "animalium-22e17.firebaseapp.com",
      projectId: "animalium-22e17",
      storageBucket: "animalium-22e17.appspot.com",
      messagingSenderId: "800956760641",
      appId: "1:800956760641:web:dab9057b718e240ec8bcc0"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged(user => {
      if(user) renderDashboard(user);
      else renderLogin();
    });

    function renderLogin(){
      document.getElementById('app-root').innerHTML = \`
        <div class="p-6 flex flex-col items-center">
          <img src="logo-animalium.png" alt="Logo" class="h-24 mb-4"/>
          <h1 class="text-2xl font-bold text-animalium-green mb-4">Animalium</h1>
          <input id="email" type="email" placeholder="Correo electrónico" class="mb-2 px-4 py-2 border rounded w-full"/>
          <input id="password" type="password" placeholder="Contraseña" class="mb-4 px-4 py-2 border rounded w-full"/>
          <div class="flex gap-2 w-full">
            <button onclick="loginWithEmail()" class="flex-1 py-2 bg-animalium-green text-white rounded">Entrar</button>
            <button onclick="renderRegister()" class="flex-1 py-2 bg-animalium-brown text-white rounded">Registrarse</button>
          </div>
        </div>\`;
    }

    function renderRegister(){
      document.getElementById('app-root').innerHTML = \`
        <div class="p-6 flex flex-col items-center">
          <img src="logo-animalium.png" alt="Logo" class="h-24 mb-4"/>
          <h1 class="text-2xl font-bold text-animalium-green mb-4">Registro</h1>
          <input id="name" type="text" placeholder="Nombre" class="mb-2 px-4 py-2 border rounded w-full"/>
          <input id="surname" type="text" placeholder="Apellido" class="mb-2 px-4 py-2 border rounded w-full"/>
          <input id="address" type="text" placeholder="Dirección" class="mb-2 px-4 py-2 border rounded w-full"/>
          <input id="phone" type="tel" placeholder="Teléfono" class="mb-2 px-4 py-2 border rounded w-full"/>
          <input id="emailReg" type="email" placeholder="Correo electrónico" class="mb-2 px-4 py-2 border rounded w-full"/>
          <input id="passwordReg" type="password" placeholder="Contraseña" class="mb-4 px-4 py-2 border rounded w-full"/>
          <button onclick="registerWithSurvey()" class="w-full py-2 bg-animalium-green text-white rounded mb-2">Registrarse</button>
          <button onclick="renderLogin()" class="w-full py-2 bg-gray-200 rounded">Volver</button>
        </div>\`;
    }

    async function loginWithEmail(){
      const email=document.getElementById('email').value;
      const pw=document.getElementById('password').value;
      try{ await auth.signInWithEmailAndPassword(email,pw); }
      catch(e){ alert(e.message); }
    }

    async function registerWithSurvey(){
      const data={
        name:document.getElementById('name').value,
        surname:document.getElementById('surname').value,
        address:document.getElementById('address').value,
        phone:document.getElementById('phone').value,
        email:document.getElementById('emailReg').value
      };
      const pw=document.getElementById('passwordReg').value;
      try{
        const res=await auth.createUserWithEmailAndPassword(data.email,pw);
        await db.collection('users').doc(res.user.uid).set(data);
      }catch(e){ alert(e.message); }
    }

    function renderDashboard(user){
      document.getElementById('app-root').innerHTML = \`
        <div class="p-6">
          <h2 class="text-xl font-semibold text-center text-animalium-green mb-4">Bienvenido, \${user.email}</h2>
          <button onclick="logout()" class="w-full mb-4 py-2 bg-red-500 text-white rounded">Cerrar sesión</button>
          <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-medium mb-2">Agendar nueva cita</h3>
            <input id="appt-date" type="date" class="mb-2 px-4 py-2 border rounded w-full"/>
            <input id="appt-time" type="time" class="mb-4 px-4 py-2 border rounded w-full"/>
            <button onclick="registerAppointment()" class="w-full py-2 bg-animalium-green text-white rounded">Registrar cita</button>
          </div>
        </div>\`;
    }

    async function registerAppointment(){
      const user=auth.currentUser;
      if(!user){ alert('Inicia sesión'); return; }
      const date=document.getElementById('appt-date').value;
      const time=document.getElementById('appt-time').value;
      try{
        await db.collection('users').doc(user.uid)
                .collection('appointments').add({date,time,created:Date.now()});
        alert('Cita registrada');
      }catch(e){ alert(e.message); }
    }

    function logout(){ auth.signOut(); }
  </script>
</body>
</html>