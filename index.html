<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Animalium - Clínica Veterinaria 🐾</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
<style>
  .text-animalium-green { color: #5F7C7D; }
  .bg-animalium-green { background-color: #5F7C7D; }
  body { margin:0; font-family: system-ui, sans-serif; background:#F7F7F7;}
</style>
</head>
<body>
<header class="bg-white shadow fixed w-full z-10">
  <div class="container mx-auto px-4 py-4 flex items-center gap-4">
    <img src="logo-animalium.png" alt="Logo" class="h-10">
    <h1 class="text-xl font-bold text-animalium-green">Animalium</h1>
    <button id="logoutBtn" class="ml-auto bg-red-500 text-white px-4 py-2 rounded hidden">Cerrar sesión</button>
  </div>
</header>
<main id="app-root" class="pt-20 container mx-auto px-4 py-8"></main>
<footer class="bg-white py-6 mt-8">
  <div class="container mx-auto px-4 text-center">
    <a href="https://wa.me/524423963079" class="text-animalium-green">WhatsApp</a> |
    <a href="https://www.facebook.com/share/1CPHVWHDGF/" class="text-animalium-green">Facebook</a>
  </div>
</footer>
<script>
const firebaseConfig = {/*...*/};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth(), db = firebase.firestore(), storage = firebase.storage();
auth.onAuthStateChanged(u=>u?dashboard(u):loginForm());

function loginForm(){
  document.getElementById('logoutBtn').classList.add('hidden');
  document.getElementById('app-root').innerHTML=`
<div class="max-w-md mx-auto bg-white p-6 rounded shadow">
  <h2 class="text-xl mb-4 text-center">Iniciar Sesión</h2>
  <input id="email" type="email" placeholder="Correo" class="w-full mb-2 px-3 py-2 border rounded"/>
  <input id="pass" type="password" placeholder="Contraseña" class="w-full mb-4 px-3 py-2 border rounded"/>
  <button onclick="login()" class="w-full bg-animalium-green text-white py-2 rounded">Entrar</button>
  <p class="mt-4 text-center"><a href="#" onclick="registerForm()" class="text-animalium-green">Registrarse</a></p>
</div>`;
}

function registerForm(){
  document.getElementById('app-root').innerHTML=`
<div class="max-w-md mx-auto bg-white p-6 rounded shadow">
  <h2 class="text-xl mb-4 text-center">Registro</h2>
  <input id="rname" placeholder="Nombre" class="w-full mb-2 px-3 py-2 border rounded"/>
  <input id="remail" type="email" placeholder="Correo" class="w-full mb-2 px-3 py-2 border rounded"/>
  <input id="rpass" type="password" placeholder="Contraseña" class="w-full mb-4 px-3 py-2 border rounded"/>
  <button onclick="register()" class="w-full bg-animalium-green text-white py-2 rounded">Crear Cuenta</button>
  <p class="mt-4 text-center"><a href="#" onclick="loginForm()" class="text-animalium-green">Volver</a></p>
</div>`;
}

async function login(){try{
  await auth.signInWithEmailAndPassword(email.value,pass.value);
}catch(e){alert(e.message)}}

async function register(){try{
  const u = await auth.createUserWithEmailAndPassword(remail.value,rpass.value);
  await db.collection('users').doc(u.user.uid).set({name:rname.value,email:remail.value});
  loginForm();
}catch(e){alert(e.message)}}

function dashboard(user){
  document.getElementById('logoutBtn').classList.remove('hidden');
  logoutBtn.onclick=()=>auth.signOut();
  document.getElementById('app-root').innerHTML=`
<div>
  <h2 class="text-xl mb-4">Tus Mascotas <button onclick="showAddPet()" class="bg-animalium-green text-white px-2 rounded">+ Mascota</button></h2>
  <div id="petList" class="space-y-4"></div>
  <h2 class="text-xl mt-8 mb-4">Tus Citas</h2>
  <ul id="appList" class="list-disc pl-5"></ul>
</div>`;
  loadPets(user.uid); loadApps(user.uid);
}

async function loadPets(uid){
  const list=petList; list.innerHTML='';
  (await db.collection('pets').where('owner','==',uid).get()).forEach(doc=>{
    const p=doc.data();
    list.innerHTML+=`<div class="bg-white p-3 rounded shadow flex gap-3">
      ${p.photoURL?`<img src="${p.photoURL}" class="h-12 w-12 rounded-full"/>`:''}
      <div><b>${p.name}</b><br/>${p.breed}</div>
    </div>`;
  });
}

async function loadApps(uid){
  db.collection('appointments').where('userId','==',uid)
    .onSnapshot(s=>{appList.innerHTML='';s.forEach(doc=>appList.innerHTML+=`<li>${doc.data().date} ${doc.data().time}</li>`);});
}

function showAddPet(){
  const html=`
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded shadow max-w-sm w-full">
    <h3 class="mb-2">Agregar Mascota</h3>
    <input id="pname" placeholder="Nombre" class="w-full mb-2 px-2 py-1 border rounded"/>
    <input id="pbreed" placeholder="Raza" class="w-full mb-2 px-2 py-1 border rounded"/>
    <input id="pphoto" type="file" accept="image/*" class="w-full mb-2"/>
    <div class="flex justify-end gap-2">
      <button onclick="addPet()" class="bg-animalium-green text-white px-2 rounded">Guardar</button>
      <button onclick="document.getElementById('modal').remove()" class="px-2 rounded bg-gray-300">Cancelar</button>
    </div>
  </div>
</div>`; document.body.insertAdjacentHTML('beforeend',html);
}

async function addPet(){
  const name=pname.value, breed=pbreed.value, file=pphoto.files[0];
  let url='';
  if(file){ const ref=storage.ref().child(`pets/${auth.currentUser.uid}/${file.name}`); await ref.put(file); url=await ref.getDownloadURL(); }
  await db.collection('pets').add({owner:auth.currentUser.uid,name,breed,photoURL:url});
  document.getElementById('modal').remove(); loadPets(auth.currentUser.uid);
}
</script>
</body>
</html>
